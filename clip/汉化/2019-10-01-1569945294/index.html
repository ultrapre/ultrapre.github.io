
  <!DOCTYPE html>
  <html id="" class="">
    <!-- OriginalSrc: https://bbs.sumisora.net/read.php?tid=11042351 -->
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <title>Galgame 汉化破解初级教程：以 BGI 为例，从解包到测试|【汉化破解研讨室】|【游戏汉化交流区】 - 『澄空学园』 GalGame专题网</title>
      

<link rel="stylesheet" type="text/css" href="assets/1569945294-5f21d2d0f0e14c54e3e080ff47c8ec08.css" referrerpolicy="no-referrer">
<link type="text/css" href="assets/1569945294-2f10d407050ab6b2185fb483267feb32.css" rel="stylesheet" referrerpolicy="no-referrer">
<link href="assets/1569945294-6ea61090578ddc8e91dc9b26707cebc8.css" rel="stylesheet" type="text/css" referrerpolicy="no-referrer">
<link rel="stylesheet" type="text/css" href="assets/1569945294-46d427da9cafb653c4ed606490c99b3a.css" referrerpolicy="no-referrer">


<style class="darkreader darkreader--fallback" media="screen"></style>
<style class="darkreader darkreader--text" media="screen"></style>
<style class="darkreader darkreader--invert" media="screen"></style>
<style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}</style>
<style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #191a1b !important;
}
html, body, input, textarea, select, button {
    background-color: #191a1b;
}
html, body, input, textarea, select, button {
    border-color: #5a5956;
    color: #f0ebe2;
}
a {
    color: #4791e7;
}
table {
    border-color: #4f4e4c;
}
::placeholder {
    color: #bfb9ac;
}
::selection {
    background-color: #125cb4;
    color: #fffffd;
}
::-moz-selection {
    background-color: #125cb4;
    color: #fffffd;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #565a0f !important;
    color: #f0ebe2 !important;
}
::-webkit-scrollbar {
    background-color: #1d1f1f;
    color: #cbc5b9;
}
::-webkit-scrollbar-thumb {
    background-color: #2c2d2d;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #343636;
}
::-webkit-scrollbar-thumb:active {
    background-color: #404142;
}
::-webkit-scrollbar-corner {
    background-color: #191a1b;
}
* {
    scrollbar-color: #2c2d2d #1d1f1f;
}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css"> 
.tr3 td,.tr3 th{border-right:1px solid #D5E5E8;}
.y-style{text-align:center;}
.tr1 th{border-right:1px solid #D5E5E8;}
.tr1 td.td1{border-left:0}
 

.signature img { max-height:250px !important; }
</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style class="darkreader darkreader--override" media="screen">.jfk-bubble {
    background-color: #000000 !important;
}
.vimvixen-hint {
    background-color: #765500 !important;
    border-color: #d5b22e !important;
    color: #f9edcc !important;
}</style>
<style type="text/css">@keyframes fadeInOpacity{0%{opacity:0}to{opacity:1}}:hover>*>.fbvd--wrapper{animation-name:fadeInOpacity;animation-duration:.3s;opacity:1}.fbvd--wrapper{position:absolute;top:10px;left:10px;opacity:0;text-align:center;margin:0;z-index:5}.fbvd--wrapper a{background: url("") no-repeat 3px 4.55px; background-color: #fff; display:inline-block;font:700 14px Helvetica,Arial,sans-serif;color:#4b4f56;text-decoration:none;vertical-align:middle;padding:0px 8px 0px;margin-right:8px;border-radius:2px; line-height: 22px; padding-left:19px; border: 1px solid #e7e7e7; background-size: 13px}.fbvd--wrapper a:last-child{margin-right:0}.fbvd--wrapper a:hover{text-decoration:none}.fbvd--wrapper a:focus{box-shadow:0 0 1px 2px rgba(88,144,255,.75),0 1px 1px rgba(0,0,0,.15);outline:none}.fbvd--wrapper b{font-size:13px;position:relative;top:1px;color:#3b5998;font-weight:400}</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style>.new-msg-tips{ position:absolute;width:115px;height:50px;margin:-45px auto auto -20px;background:url(""); }</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style type="text/css">
.signature{height:expression(this.scrollHeight>parseInt(this.currentStyle.maxHeight)?this.currentStyle.maxHeight:"auto");}
.tiptop a,.tipad a{ margin:0 .2em}
.tips li{list-style:none;width:30%;height:24px;line-height:24px; min-width:210px;margin:0 5px;float:left;overflow:hidden;text-overflow:ellipsis;}
.dig{ float:left; font-size:12px; background:#FFFFD4 url("") no-repeat .4em .1em; border:#E6E6B3 1px solid ; border-bottom-width:2px; border-right-width:2px; padding:.2em .8em .2em 2.4em; cursor: pointer; margin:.6em .1em; color:#000}
.dig:hover{ border:#E6E6B3 2px solid ; border-bottom-width:1px; border-right-width:1px; text-decoration:none}
.menu a.a6:hover{text-decoration:underline;background:#CEECF0;color:#00f}
.user-pic { margin:0 auto .5em;}
.user-pic table{ border:none}
.user-pic img.pic{ margin:0 0 .3em;background:#F3F8EF; padding:3px; border:1px solid #DAEBCD}
.user-info{ position:absolute;line-height:160%; margin-left:-1.5em; margin-top:-1em}
.user-infoWrap{background:#FFF; border:1px solid #004C7D; border-top:1px #A6CBE7 solid; border-left:1px solid #A6CBE7; padding:.5em 1em; margin-left:20px;display:block;}
.user-info .co{position:absolute; width:10px;height:20px; margin-left:-1.8em; margin-top:2em; background:url(images/wind/user-info-co.gif)}
 
.small{font-size:12px}
.middle{font-size:14px}
.big{font-size:18px}
</style>
<style class="darkreader darkreader--sync" media="screen"></style>
<style>.face{ height:23px;padding:7px 0 0 8px;text-align:left;background:#E0F0F9 url("");cursor:move}.face div{ width:56px;height:18px;text-align:center;padding:5px 0 0;cursor:pointer;}.face div.lian{ background:#ffffff url("") no-repeat;cursor:auto;}</style>
<style class="darkreader darkreader--sync" media="screen"></style>

      <style class="mx-wc-style">
        .mx-wc-main img {max-width: 100%;}
        .mx-wc-main{
          box-sizing: content-box;
          background-color: rgb(25, 26, 27) !important;
          margin: 0 auto;
          margin-top: 20px;
          max-width: 1054px;
        }
        @media (min-width: 768px) {
          .mx-wc-main { padding: 15px 15px 80px 15px }
        }
        @media (max-width: 767px) {
          .mx-wc-main { padding: 15px 3px 80px 3px }
        }
  
      </style>
    </head>
    <body style="background-color: #ffffff !important; min-height: 100%; height: auto; position: static !important; overflow: auto !important; padding-bottom: 0px !important;" id="" class="">
      <div class="mx-wc-main">
        <DIV id="wrapA" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><DIV id="main" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><FORM name="delatc" method="post" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><DIV class="t t2" data-darkreader-inline-border-top="" style="border-top: 0px; --darkreader-inline-border-top: initial;display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><TABLE cellspacing="0" cellpadding="0" width="100%" data-darkreader-inline-border-top="" style="table-layout: fixed; border-top: 0px; --darkreader-inline-border-top: initial;display: table !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><TBODY style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><TR class="tr1" style="display: block !important;float: none !important;position: relative !important;top: 0 !important;left: 0 !important;border: 0px !important;width: 100% !important;min-width: 100% !important;max-width: 100% !important;height: auto !important;min-height: auto !important;max-height: 100% !important;margin: 0px !important;padding: 0px !important;"><th height="100%" class="r_one mx-wc-selected-elem mx-wc-1569945294" valign="top" id="td_tpc" style="padding: 5px 15px 0px; border: 0px; overflow: hidden; --darkreader-inline-border-top: initial; --darkreader-inline-border-right: initial; --darkreader-inline-border-bottom: initial; --darkreader-inline-border-left: initial; display: table-cell; float: none !important; position: relative !important; top: 0px !important; left: 0px !important; margin: 0px !important; flex: unset !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left="">
			<div class="tiptop">
			<span class="fl" style="white-space:nowrap;">
			<a href="https://bbs.sumisora.net/post.php?action=quote&amp;fid=78&amp;tid=11042351&amp;pid=tpc&amp;article=0" onclick="return sendurl(this,4,event)" id="quote_tpc" title="引用回复这个帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">引用</a> <a href="https://bbs.sumisora.net/post.php?action=modify&amp;fid=78&amp;tid=11042351&amp;pid=tpc&amp;article=0" id="modify_tpc" onclick="return sendurl(this,4,event)" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">编辑</a>
			<a href="https://bbs.sumisora.net/message.php?action=write&amp;touid=209259" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">短信</a>

			<a href="https://bbs.sumisora.net/operate.php?action=report&amp;tid=11042351&amp;pid=tpc" onclick="return sendurl(this,8)" id="report_tpc" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">举报</a>

			<a href="https://bbs.sumisora.net/read.php?tid=11042351&amp;uid=209259" title="只看楼主的所有帖子" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">只看</a>

			<a style="cursor:pointer;" onclick="copyUrl('tpc')" title="此楼地址" data-mx-warn="Empty URL">锚点</a>
			</span>

			<div class="c"></div>
			</div>
			<h1 id="subject_tpc" class="fl">&nbsp;Galgame 汉化破解初级教程：以 BGI 为例，从解包到测试</h1>
			

			<div id="p_tpc" class="c"></div>

			<div id="mag_tpc" class="tpc_content"><h6 class="quote"><span class="s3 f12 fn">管理提醒：


			</span></h6><blockquote class="blockquote">本帖被 乙津夢 执行加亮操作(2015-06-21)

			</blockquote></div>

<!--
-->

			<div class="tpc_content" id="read_tpc">囧，CK 这边的编辑器是 WindCode，也不能直接插入 HTML，只能大概排一下版了。对排版和格式有高要求的同学请看<a href="http://i.watashi.me/archives/1.html" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">这里</a>。<br><br><a href="https://creativecommons.org/licenses/by-nc-nd/3.0/cn/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer"><span class="highslide"><img src="assets/1569945294-07a4f2d243d604a6ad99a00100c44ad3.png" border="0" style="max-width: 100%;max-height: 800px;"></span></a>&nbsp; 转载请注明出处。<br><br><hr><b><b><br></b>Ever tried.&nbsp;</b><b>Ever failed.<br>No matter.&nbsp;</b><b>Try again.<br>Fail again.&nbsp;</b><b>Fail better.</b><b><br></b><b><br></b><b><br></b>一直想写一篇面向新手的 Galgame 汉化教程，但一直苦于没有时间。现在终于考完了试，申请也告一段落，这才抽了点时间来写这篇文。还有，工口你认真学，今后杏爱会的程序就看你的了。<br><br>本教程假设你已经满足以下条件：<br><br><ul style="margin:0 0 0 15px"><li>玩过 Galgame，了解一般 Galgame 资源存储的方式</li><li>会一门编程语言，VB6 和 JavaScript 等前端语言除外</li><li>能看懂用其它编程语言写出的源代码，此处特指用 C++</li><li>能看懂汇编，51 单片机的汇编语言就行</li><li>懂数据结构</li><li>知道什么是字符编码</li><li>英语水平还说得过去</li><li>懂一点儿日语</li></ul><br>本教程中使用的名词：<br><br><ul style="margin:0 0 0 15px"><li>封包：指游戏的资源文件在游戏安装目录下的保存形式</li><li>脚本：含有二进制控制符和纯文本的文件</li><li>文本：从脚本中提取，人类能够读懂的文本文件</li></ul><br>首先来看看破解都要干啥：<br><br><ul style="margin:0 0 0 15px"><li>解开游戏的封包文件</li><li>从提取出的脚本中提取出文本</li><li>从提取出的脚本中提取出图片</li><li>把翻译好的文本写回到脚本里</li><li>把新的图片和脚本放回到封包里</li><li>修改游戏主程序，使之能正常读取中文</li></ul><br>好，让我们开始吧。<br><br><font size="4"><b>1. 准备</b></font><br><br>我们以方糖社的《<a href="http://www.lumpofsugar.co.jp/product/hanairo/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">花色ヘプタグラム</a>》为例进行实战。不过在开始之前，你需要准备几种工具：<br><ul style="margin:0 0 0 15px"><li>一款支持多语言编码的文本编辑器，例如&nbsp;<a href="http://www.flos-freeware.ch/notepad2.html" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Notepad2</a></li><li>一款十六进制编辑器，最好也能支持多语言编码，例如&nbsp;<a href="http://www.sweetscape.com/010editor/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">010Editor</a></li><li>一款反汇编工具，例如&nbsp;<a href="http://ollydbg.org/" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">OllyDbg</a></li><li>你常用的 IDE，比如 Visual Studio</li></ul>工具的用法在此不再赘述，请自行谷歌。<br>安装游戏后打开游戏的主目录，你会发现这些文件（已略去部分无用文件）：<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code1'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code1" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">643</span><span class="pln"> autoload</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">1</span><span class="pun">,</span><span class="lit">817</span><span class="pun">,</span><span class="lit">109</span><span class="pln"> data01000</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">876</span><span class="pun">,</span><span class="lit">414</span><span class="pun">,</span><span class="lit">725</span><span class="pln"> data02000</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">654</span><span class="pun">,</span><span class="lit">502</span><span class="pun">,</span><span class="lit">744</span><span class="pln"> data02001</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">1</span><span class="pun">,</span><span class="lit">179</span><span class="pun">,</span><span class="lit">169</span><span class="pun">,</span><span class="lit">979</span><span class="pln"> data02010</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">12</span><span class="pun">,</span><span class="lit">594</span><span class="pun">,</span><span class="lit">853</span><span class="pln"> data02050</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">299</span><span class="pun">,</span><span class="lit">065</span><span class="pun">,</span><span class="lit">396</span><span class="pln"> data02100</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">21</span><span class="pun">,</span><span class="lit">874</span><span class="pun">,</span><span class="lit">416</span><span class="pln"> data02950</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">14</span><span class="pun">,</span><span class="lit">331</span><span class="pun">,</span><span class="lit">692</span><span class="pln"> data03000</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">922</span><span class="pun">,</span><span class="lit">747</span><span class="pun">,</span><span class="lit">352</span><span class="pln"> data04000</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">75</span><span class="pun">,</span><span class="lit">902</span><span class="pun">,</span><span class="lit">855</span><span class="pln"> data05000</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">860</span><span class="pun">,</span><span class="lit">160</span><span class="pln"> </span><span class="typ">Heptagram</span><span class="pun">.</span><span class="pln">exe
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">34</span><span class="pun">,</span><span class="lit">148</span><span class="pun">,</span><span class="lit">877</span><span class="pln"> sysgrp</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">290</span><span class="pun">,</span><span class="lit">498</span><span class="pln"> sysprg</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">3</span><span class="pun">,</span><span class="lit">702</span><span class="pun">,</span><span class="lit">778</span><span class="pln"> syssnd</span><span class="pun">.</span><span class="pln">arc
</span><span class="lit">2012</span><span class="pun">/</span><span class="lit">09</span><span class="pun">/</span><span class="lit">26</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">33</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">2</span><span class="pun">,</span><span class="lit">825</span><span class="pln"> system</span><span class="pun">.</span><span class="pln">arc</span></pre><br><br>很明显，Heptagram.exe 是游戏的主程序，*.arc是游戏的封包文件。接下来，我们开始正式的流程。<br><br><b><font size="4">2. 破解</font><br><br><font size="3">2.1. 运行破解</font></b><font size="3"><br></font><font size="3"><br></font>双击 Heptagram.exe 来测试一下，发现没有出现游戏主窗口；而用 AppLocate 工具加载后却能够正常运行。这说明开发商在游戏中进行了某种检查，以防止游戏在日本日外的国家运行（原因大家都知道，而且还有家中二公司把这点做到了极致）。<br><br>好，让我们想一想，如何得到当前操作系统的区域信息？<br><br><ul style="margin:0 0 0 15px"><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">使用&nbsp;</span></span><a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/dd318135%28v=vs.85%29.aspx" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">GetUserDefaultLCID</a><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">API</span></span></li><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">使用</span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/dd318120%28v=vs.85%29.aspx" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">GetSystemDefaultLangID</a><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">API</span></span></li><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">使用</span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/dd318123%28v=vs.85%29.aspx" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">GetSystemDefaultUILanguage</a><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">API</span></span></li><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">使用</span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/ms724421%28v=vs.85%29.aspx" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">GetTimeZoneInformation</a><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">API</span></span></li><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">使用</span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd319072%28v=vs.85%29.aspx" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">MultiByteToWideChar</a><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""> </span></span><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">API 转化一个字符串，检查结果</span></span></li><li><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color="">等等……</span></span></li></ul><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><br></span><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><br></span>透露一下，BGI 引擎使用 GetSystemDefaultLangID 来确定当前操作系统的区域。<br>运行 OllyDbg，载入 Heptagram.exe，如图。<br><br><span class="highslide"><img src="assets/1569945294-5ecd353afed2fb80f91e4ab1ad3c4d67.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br>按下&nbsp;CTRL + N，在打开的 API 列表中找到&nbsp;GetSystemDefaultLangID，右键选择“在每个参考上设置断点”。如图。<br><br><span class="highslide"><img src="assets/1569945294-179b478fce0518e417b62c989a90ee89.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br><br>双击 Breakpoints 窗口中的项，来到&nbsp;GetSystemDefaultLangID&nbsp;的调用位置：<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code2'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code2" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="lit">00455CE0</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">/</span><span class="pln">$&nbsp;&nbsp;FF15 D0E04A00 call&nbsp;&nbsp;&nbsp;&nbsp;dword ptr </span><span class="pun">[&lt;&amp;</span><span class="pln">KERNEL32</span><span class="pun">.</span><span class="typ">GetSystemD</span><span class="pun">&gt;;</span><span class="pln"> </span><span class="pun">[</span><span class="typ">GetSystemDefaultLangID</span><span class="pln">
</span><span class="lit">00455CE6</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">8B5424</span><span class="pln"> </span><span class="lit">04</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; edx</span><span class="pun">,</span><span class="pln"> dword ptr </span><span class="pun">[</span><span class="pln">esp</span><span class="pun">+</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
</span><span class="lit">00455CEA</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">25</span><span class="pln"> FF030000&nbsp;&nbsp; </span><span class="kwd">and</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3FF</span><span class="pln">
</span><span class="lit">00455CEF</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">33C9</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp; ecx</span><span class="pun">,</span><span class="pln"> ecx
</span><span class="lit">00455CF1</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">3BC2</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> edx
</span><span class="lit">00455CF3</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">0F94C1</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sete&nbsp;&nbsp;&nbsp;&nbsp;cl
</span><span class="lit">00455CF6</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">8BC1</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> ecx
</span><span class="lit">00455CF8</span><span class="pln">&nbsp;&nbsp;\.&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retn</span></pre><br>在简体中文环境下，&nbsp;GetSystemDefaultLangID&nbsp;返回值是&nbsp;0x804，而在日语环境下，返回值是&nbsp;0x411。那么怎么改？很简单，直接把&nbsp;0x411&nbsp;写入返回值的寄存器就行了。这样，无论是什么语言的系统，都会被认为是日语系统。<br>双击&nbsp;00455CE0&nbsp;这一行，把汇编改为&nbsp;mov eax, 411。改好后的这部分代码如下所示：<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code3'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code3" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="lit">00455CE0</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B8 </span><span class="lit">11040000</span><span class="pln">&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> </span><span class="lit">411</span><span class="pln">
</span><span class="lit">00455CE5</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">90</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="pun">;修改后的代码比原先的要短，所以剩余的部分会用</span><span class="pln"> nop </span><span class="pun">补齐</span><span class="pln">
</span><span class="lit">00455CE6</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">8B5424</span><span class="pln"> </span><span class="lit">04</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; edx</span><span class="pun">,</span><span class="pln"> dword ptr </span><span class="pun">[</span><span class="pln">esp</span><span class="pun">+</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
</span><span class="lit">00455CEA</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">25</span><span class="pln"> FF030000&nbsp;&nbsp; </span><span class="kwd">and</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3FF</span><span class="pln">
</span><span class="lit">00455CEF</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">33C9</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor&nbsp;&nbsp;&nbsp;&nbsp; ecx</span><span class="pun">,</span><span class="pln"> ecx
</span><span class="lit">00455CF1</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">3BC2</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> edx
</span><span class="lit">00455CF3</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">0F94C1</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sete&nbsp;&nbsp;&nbsp;&nbsp;cl
</span><span class="lit">00455CF6</span><span class="pln">&nbsp;&nbsp;</span><span class="pun">|.</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">8BC1</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp; eax</span><span class="pun">,</span><span class="pln"> ecx
</span><span class="lit">00455CF8</span><span class="pln">&nbsp;&nbsp;\.&nbsp;&nbsp;C3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retn</span></pre><br><br>改好之后，在 CPU 窗口右键，复制到可执行文件 -&gt; 所有修改 -&gt; 全部复制，再在弹出的窗口中右键，保存文件，命名为 Heptagram_NoCheck.exe，完成后退出 OllyDbg。<br><br>接下来找到刚保存的 Heptagram_NoCheck.exe，双击运行，游戏界面是不是出来了？<br><br><font size="3"><b>2.2. 游戏脚本</b></font><font size="3"><br></font><font size="3"><br></font><font size="2"><b>2.2.1. 解包</b></font><font size="2"><br></font><font size="2"><br></font>这一步可以说是整个汉化过程中最简单的了（当然，这是建立在前辈们的辛苦分析上的）：用老毛子出品的 AnimED 即可（不推荐使用 Crass）。<br><br>从 BGI 汉化经验来看，脚本文件一般都保存在前几个封包中（本游戏的脚本就在 data01000.arc 中）。如果你找不到，你可以把封包逐一拖到 ExtractData 窗口中观察。单个脚本的大小一般不会超过 200KB。<br><br>使用 AnimED 解开 data01000.arc ，拿到脚本（同样，略去了部分文件）：<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code4'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code4" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">64</span><span class="pun">,</span><span class="lit">740</span><span class="pln"> a01
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">72</span><span class="pun">,</span><span class="lit">838</span><span class="pln"> a02
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">76</span><span class="pun">,</span><span class="lit">598</span><span class="pln"> a03
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">6</span><span class="pun">,</span><span class="lit">433</span><span class="pln"> b06_3
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">47</span><span class="pun">,</span><span class="lit">365</span><span class="pln"> b07_1
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">71</span><span class="pun">,</span><span class="lit">012</span><span class="pln"> b07_2
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">92</span><span class="pun">,</span><span class="lit">156</span><span class="pln"> c06_2
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">77</span><span class="pun">,</span><span class="lit">374</span><span class="pln"> d09
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">79</span><span class="pun">,</span><span class="lit">352</span><span class="pln"> d10_1
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">1</span><span class="pun">,</span><span class="lit">712</span><span class="pln"> main
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">3</span><span class="pun">,</span><span class="lit">150</span><span class="pln"> s_ci_02
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">110</span><span class="pun">,</span><span class="lit">513</span><span class="pln"> </span><span class="typ">Yuzuriha</span><span class="pln">
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">128</span><span class="pun">,</span><span class="lit">763</span><span class="pln"> _01
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">93</span><span class="pun">,</span><span class="lit">819</span><span class="pln"> _02
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">154</span><span class="pun">,</span><span class="lit">264</span><span class="pln"> _03
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">100</span><span class="pun">,</span><span class="lit">339</span><span class="pln"> _07
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="lit">268</span><span class="pun">,</span><span class="lit">696</span><span class="pln"> _08
</span><span class="lit">2013</span><span class="pun">/</span><span class="lit">01</span><span class="pun">/</span><span class="lit">13</span><span class="pln">&nbsp;&nbsp;</span><span class="lit">16</span><span class="pun">:</span><span class="lit">31</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="lit">28</span><span class="pun">,</span><span class="lit">475</span><span class="pln"> _10_2</span></pre><br><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">打开准备好的 Notepad2，载入其中的&nbsp;</span></span></span>_01<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">&nbsp;文件，然后按下&nbsp;</span></span></span>F8<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">，选择&nbsp;</span></span></span>Japanese (Shift-JIS)<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">。你会发现，这个文件就是游戏的第一章：</span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span class="highslide"><img src="assets/1569945294-8f4fdd2898c5c26dc0dcc844904836e9.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><font size="4"><b><br></b></font><font size="2"><b>2.2.2. 二进制脚本分析</b></font><br><br>在打开的&nbsp;_01&nbsp;文件中，你可以看到不可读的二进制代码和可读的文本混在一起。接下来，打开你的十六进制编辑器，载入_01&nbsp;文件。<br><br><span class="highslide"><img src="assets/1569945294-e7f3c145ac107c5a8b0e8d0ab2c578ea.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br>如图所示，BGI 脚本分为四部分：<br><br><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><ul style="margin:0 0 0 15px"><li><span style="font-family:inherit ">头部 Magic：用于校验该文件的类型</span></li><li><span style="font-family:inherit ">脚本头部：定义了该脚本所需的全局变量</span></li><li><span style="font-family:inherit ">指令部分：控制游戏的流程</span></li><li><span style="font-family:inherit ">文本列表：我们最感兴趣的东西</span></li></ul><br><br></span></span>在游戏执行中，引擎不断地读取指令部分中的指令，形成了游戏的时间线。 可以看出，0x00000003&nbsp;之后的四字节（DWORD）和下面文本列表中字符串&nbsp;_01.txt&nbsp;（起始地址为&nbsp;0x18D1C）有关：<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code5'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code5" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="lit">0x18D1C</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x1C</span><span class="pln"> </span><span class="pun">(</span><span class="pln">MAGIC </span><span class="pun">长度)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0x34</span><span class="pln"> </span><span class="pun">(头部长度)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">0x18CCC</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0x00000003</span><span class="pln"> </span><span class="pun">之后的四字节)</span></pre><br>如果你不放心，可以再找几句话计算看看。<br>那么，思路就确定下来了：<br>逐个读取所有的 0x00000003，把之后的四字节作为地址，修正后用来查找目标处的字符串。也就是<br><h6 class="quote"><a href="javascript:" onclick="CopyCode(document.getElementById('code6'));" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">Copy code</a></h6><pre class="prettyprint" id="code6" style="border-radius:5px;font-family:monaco,consolas,monospace;font-size:12px;overflow-x:auto;line-height:1.4em"><span class="typ">String</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GetStringAt</span><span class="pun">(</span><span class="typ">GetUnsignedIntAt</span><span class="pun">(</span><span class="typ">AddressOfAny</span><span class="pun">(</span><span class="lit">0x03</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">LengthOf</span><span class="pun">(</span><span class="pln">magic</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">LengthOf</span><span class="pun">(</span><span class="pln">header</span><span class="pun">))</span></pre><br><br>接下来，用你最擅长的编程语言写一个<a href="https://github.com/xupefei/BGIKit/blob/master/ScriptDecoder/Program.cs" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">提取文本的工具</a>吧。<br><br><font size="3"><b>2.3. 图片提取与转化</b></font><font size="3"><br></font><font size="3"><br></font>BGI 引擎的图片有两种格式：标准 BMP/PNG 和去掉<a href="https://en.wikipedia.org/wiki/BMP_file_format#File_structure" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">文件头</a>的 BMP。前者用于 CG 和立绘，后者用于系统图片（sysgrp.arc中的图片文件）。<br><span style="color: rgb(255, 0, 0); --darkreader-inline-color:#e63f3c;" data-darkreader-inline-color=""><b>注意</b>：部分图片的像素排序是<b>反转的</b>，保存时也要保持反转排序（在 PS 的保存窗口中勾选<b>翻转行序</b>）<br><b>注意2</b>：如果图片含有 Alpha 通道，那么 Alpha 通道也要修！</span><br><br><font size="2"><b>2.3.1. 标准 BMP/PNG 文件</b></font><font size="2"><b><br></b></font><font size="2"><b><br></b></font>这些文件很好判断。对于 BMP 文件，文件头部总是&nbsp;BM&nbsp;两个字母；而对于 PNG 格式，文件头总是 {0x89, 0x50, 0x4E, 0x47}（写成中文的话就是&nbsp;塒NG）。给解出来的文件添加相应后缀，用 Photoshop 打开即可。<br><br><font size="2"><b>2.3.2. 系统图片</b></font><font size="2"><b><br></b></font><font size="2"><b><br></b></font>让我们再次祭出十六进制编辑器。<br><br><span class="highslide"><img src="assets/1569945294-e491c5b29f10af8ae026f32cbfe55e24.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br>如图，文件的钱六个字节分别是图片宽度，图片高度和色深。可以看出，sys_title_006&nbsp;图片是一个 1280 * 720 的 32 位图片。<br>再次使用你最拿手的编程语言，写一个小程序来修复 BMP 文件头吧：<a href="https://github.com/xupefei/BGIKit/blob/master/SysgrpConverter/Program.cs" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">请阅读&nbsp;BeginBuildBMP&nbsp;函数的代码</a>。<br><br>至此，资源破解结束。<br><br><font size="4"><b>3. 资源回封</b></font><font size="4"><br></font><font size="4"><br></font><font size="3"><b>3.1. 游戏脚本</b></font><font size="3"><br></font><font size="3"><br></font>脚本的回封很简单，<a href="https://github.com/xupefei/BGIKit/blob/master/ScriptEncoder/Program.cs" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">照着提取工具写一个对应的逆运算</a>就行了。注意，新文件中的汉字必须是 GBK 编码。<br><br><font size="3"><b>3.2. 图片</b></font><font size="3"><br></font><font size="3"><br></font><font size="2"><b>3.2.1. 标准图片</b></font><font size="2"><br></font><font size="2"><br></font>去掉后缀就行。<br><br><font size="2"><b>3.2.2. 系统图片</b></font><font size="2"><br></font><font size="2"><br></font>刚刚我们添加了 BMP Header，现在我们需要一个去掉 BMP Header 的工具：<a href="https://github.com/xupefei/BGIKit/blob/master/SysgrpConverter/Program.cs" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">请阅读&nbsp;BeginBuildResource&nbsp;函数的代码</a>。<br><br><font size="4"><b>4. 测试运行</b></font><font size="4"><br></font><font size="4"><br></font>上面，我<br><br><ul style="margin:0 0 0 15px"><li>“汉化”了一张 CG （ev_warn02&nbsp;来自&nbsp;data02010.arc）：</li></ul><br><span class="highslide"><img src="assets/1569945294-f1e871ab381524b0448533c521628d0a.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><ul style="margin:0 0 0 15px"><li><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">汉化了一张 系统图 （</span></span></span>sys_title_006<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">&nbsp;来自&nbsp;</span></span></span>sysgrp.arc<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">）：</span></span></span></li></ul><span class="highslide"><img src="assets/1569945294-dda619e9248124c1445aa625989738ed.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><ul style="margin:0 0 0 15px"><li><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">汉化了&nbsp;</span></span></span>_01<span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">&nbsp;脚本的前几句话：</span></span></span></li></ul><span class="highslide"><img src="assets/1569945294-d27f91901bef4c78d582528681e68eac.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br>把&nbsp;ev_warn02&nbsp;的后缀去掉，把&nbsp;sys_title_006&nbsp;的文件头去掉，把文本回写到&nbsp;_01&nbsp;中，生成新文件再重新命名为&nbsp;_01。<br>完成后，把三个文件重命名为原本的名字，复制到游戏目录下。双击游戏，运行。<br><br><span class="highslide"><img src="assets/1569945294-805764da40185e5eac396a40317772a5.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><span class="highslide"><img src="assets/1569945294-97ff1ca0f206e738c9294b4f643ade29.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor="">图片很正常，能用。可是脚本就没这么方便了：</span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span style="font-family:panic sans "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><span style="background-color: rgb(255, 255, 255); --darkreader-inline-bgcolor:#191a1b;" data-darkreader-inline-bgcolor=""><br></span></span></span><span class="highslide"><img src="assets/1569945294-06f9f5f30065345842babd0907c945d5.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><br>出现了乱码。<br>这就不得不说字符编码和边界检查了。点击<a href="https://bbs.sumisora.net/read.php?tid=10916692" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">这里</a>和<a href="http://shera.iteye.com/blog/409666" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">这里</a>，仔细阅读肠姐姐的文章。<br>BGI 引擎中存在多处校验边界的代码，具体可以通过 OllyDbg 查找（CTRL+L）cmp al, 0A0&nbsp;来定位（《花色ヘプタグラム》中只有两处）。<br>其它需要修改的地方：<br><span style="font-family:inherit "><span style="color: rgb(51, 51, 51); --darkreader-inline-color:#ddd7cd;" data-darkreader-inline-color=""><ul style="margin:0 0 0 15px"><li><span style="font-family:inherit ">CreateFontA 的 fdwCharSet 参数：改为 86 （其他游戏可能会有 CreateFontIndirectA 函数，后者要麻烦一些）</span></li><li><span style="font-family:inherit ">MultiByteToWideChar 的 Charset 参数：改为 3A8</span></li><li><span style="font-family:inherit ">cmp eax, 0EF40 ; 改为 0FE40</span></li><li><span style="font-family:inherit ">cmp ebx, 0EF40 ; 改为 0FE40</span></li><li><span style="font-family:inherit ">cmp ebx, 8140 ; 8140 是 Shift-JIS 编码中的全角空格，所以此处应改为 0A1A1 （GBK 的全角空格）</span></li></ul><br></span></span>修改后保存主程序，再次运行，一切正常。<br><br><span class="highslide"><img src="assets/1569945294-65247a9983aa1c7e1bf1c08dbec9a066.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><font size="5"><b><font size="4"><br></font></b></font><font size="5"><b><font size="4"><br></font></b></font><font size="5"><b><font size="4">5. 后续工作</font></b></font><font size="4"><b><br></b></font><font size="4"><b><br></b></font><font size="5"><b><font size="3">5.1. 字体</font></b></font><font size="3"><b><br></b></font><font size="3"><b><br></b></font>用十六进制编辑器打开刚刚运行成功的主程序，把所有ＭＳ 明朝（俵俽 柧挬），ＭＳ ゴシック（俵俽 僑僔僢僋），MS Mincho，MS Gothic&nbsp;改为黑体，或&nbsp;SimHei，别忘了把空余的字节全填上&nbsp;0x00。<br><br><font size="5"><b><font size="3">5.2. 窗口标题</font></b></font><font size="3"><b><br></b></font><font size="3"><b><br></b></font>从&nbsp;system.arc&nbsp;中得到&nbsp;ipl._bp，用十六进制编辑器修改字符串。<br><br><font size="5"><b><font size="3">5.3. （按需）人名乱码，下一句提示符乱码，方括号乱码</font></b></font><font size="3"><b><br></b></font><font size="3"><b><br></b></font>从&nbsp;sysprg.arc&nbsp;中提取相应的&nbsp;._bp&nbsp;文件，用十六进制编辑器修改。下面的是完成品，补丁质量：<br><br><br><span class="highslide"><img src="assets/1569945294-9cb6244ef34335f7e53d970ec1fdc9ab.png" border="0" style="max-width: 100%;max-height: 800px;"></span><br><font size="5"><b><font size="3"><br></font></b></font><font size="5"><b><font size="3"><br></font></b></font><font size="5"><b><font size="3">5.4. 补丁的注意事项</font></b></font><font size="3"><b><br></b></font><font size="3"><b><br></b></font>既然 BGI 不用封包就能读取汉化后的文件，那么在发补丁时怎么办？打补丁之后，游戏目录不得一下子多出几百个文件么？孩子，你需要&nbsp;<a href="https://baike.baidu.com/view/4096812.htm" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">MoleBox</a>。<br><br><font size="5"><b><font size="4">6. 接下来？</font></b></font><font size="4"><b><br></b></font><font size="4"><b><br></b></font>如果你觉得自己需要再次学习基本知识，请把<a href="https://bbs.sumisora.net/thread.php?fid=78" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">这里</a>所有回复大于 2 的主题帖读完。<br>如果你觉得自己能够挑战更高难度的破解，请点<a href="https://bbs.sumisora.net/read.php?tid=10983263" target="_blank" referrerpolicy="no-referrer" rel="noopener noreferrer">这里</a>。<br>如果你有任何疑问，请留言。<div id="alert_tpc" style="color: gray; margin-top: 30px; --darkreader-inline-color:#bfb9ac;" data-darkreader-inline-color="">[ 此帖被amemiya在2014-05-15 23:49重新编辑 ]</div></div>
		</th></TR></TBODY></TABLE></DIV></FORM></DIV></DIV>
        
      </div>
    </body>
  </html>